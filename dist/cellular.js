!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.cellular=e():t.cellular=e()}(self,(function(){return(()=>{"use strict";var t={d:(e,a)=>{for(var n in a)t.o(a,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:a[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Cell:()=>z,Grid:()=>N,Simulation:()=>r,SimulationLogic:()=>h,errors:()=>a,simulations:()=>n});var a={};t.r(a),t.d(a,{CoordinatesOutOfBoundError:()=>i});var n={};function i(){throw new Error("Coordinates out of bounds")}t.r(n),t.d(n,{briansBrain:()=>b,conway:()=>x,freeze:()=>y,mirage:()=>M,move:()=>j,seeds:()=>P,water:()=>w}),i.prototype=Error.prototype;const r=function t(e,a,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.states=a,this.logic=n};function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t){for(var e=0;e<t.height;e+=1)for(var a=0;a<t.width;a+=1)t.getCell(a,e).forceState(0)}function l(t,e){for(var a=0;a<t.height;a+=1)for(var n=0;n<t.width;n+=1){var i=Math.random(),r=t.getCell(n,a);i>=1-e?r.forceState(1):r.forceState(0)}}const h=function t(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s;o(this,t),this.draw=e,this.update=a,this.fill=n,this.clear=i};function u(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function f(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?u(Object(a),!0).forEach((function(e){c(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function c(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var d={Water:{empty:!1,water:!0,currentFlowStep:0,flowSteps:0,flowDirection:1},Empty:{empty:!0},Dirt:{empty:!1,wall:!0}},v=new h((function(t){t.draw(t.state.wall?100:0,t.state.wall?100:0,t.state.water?255:0)}),(function(t,e,a){var n=t.getCell(e,a);if(n.state.water){if(t.isInBounds(e,a+1)){var i=t.getCell(e,a+1);if(i.state.empty&&i.nextState.empty)return n.state.flowSteps=Math.max(n.state.flowSteps-10,0),i.nextState=n.state,void(n.nextState=i.state);i.state.water&&i.nextState.water&&(i.state.flowSteps=Math.max(i.state.flowSteps-10,0))}var r=e+n.state.flowDirection;if(t.isInBounds(r,a)){var o=t.getCell(r,a);if(o.state.empty&&o.nextState.empty)return n.state.currentFlowStep+=1,void(n.state.currentFlowStep>n.state.flowSteps&&(n.state.flowSteps+=1,n.state.currentFlowStep=0,o.nextState=n.state,n.nextState=o.state));o.state.water&&o.nextState.water&&(n.state.flowSteps+=1,o.state.flowSteps=Math.max(o.state.flowSteps-1,0))}n.state.flowDirection=-n.state.flowDirection}}),(function(t,e){for(var a=0;a<t.height;a+=1)for(var n=0;n<t.width;n+=1){var i=t.getCell(n,a);Math.random()>=1-e?Math.random()>.8?i.forceState(f({},d.Water)):i.forceState(f({},d.Dirt)):i.forceState(f({},d.Empty))}}),(function(t){for(var e=0;e<t.height;e+=1)for(var a=0;a<t.width;a+=1)t.getCell(a,e).forceState(f({},d.Empty))}));const w=new r("Water",d,v);var g={Frozen:2,Moving:1,Dead:0},p=new h((function(t){t.draw(0,t.state===g.Moving?255:0,t.state===g.Frozen?255:0)}),(function(t,e,a){var n=t.getCell(e,a);if(n.state===g.Moving)if(t.hasNeighborWithState(e,a,g.Frozen))n.nextState=g.Frozen;else{var i=e+Math.floor(3*Math.random())-1,r=a+Math.floor(3*Math.random())-1;if(t.isInBounds(i,r)){var o=t.getCell(i,r);o.state===g.Dead&&o.nextState===g.Dead&&(o.nextState=g.Moving,n.nextState=g.Dead),(t.isAtEdge(i,r)||t.hasNeighborWithState(i,r,g.Frozen))&&(o.nextState=g.Frozen)}}}));const y=new r("Freeze",g,p);var S={Alive:1,Dying:2,Dead:0},m=new h((function(t){t.draw(t.state===S.Alive?255:0,t.state===S.Alive?255:0,t.state>=S.Alive?255:0)}),(function(t,e,a){var n=t.getCell(e,a),i=t.neighborsWithState(e,a,S.Alive);n.state===S.Dead?2===i&&(n.nextState=S.Alive):n.state===S.Alive?n.nextState=S.Dying:n.state===S.Dying&&(n.nextState=S.Dead)}));const b=new r("Brian's Brain",S,m);var C={Alive:1,Dead:0},D=new h((function(t){t.draw(0,t.state===C.Alive?255:0,0)}),(function(t,e,a){var n=t.getCell(e,a),i=t.neighborsWithState(e,a,1);n.state===C.Alive?(i<2||i>3)&&(n.nextState=C.Dead):3===i&&(n.nextState=C.Alive)}));const x=new r("Conway",C,D);var A={Alive:1,Dead:0},O=new h((function(t){t.draw(t.state===A.Alive?255:0,t.state===A.Alive?255:0,0)}),(function(t,e,a){var n=t.getCell(e,a),i=e+Math.floor(3*Math.random())-1,r=a+1;t.isInBounds(i,r)&&(t.getCell(i,r).state===A.Alive?n.nextState=A.Alive:n.nextState=A.Dead)}));const M=new r("Mirage",A,O);var k={Alive:1,Dead:0},I=new h((function(t){t.draw(0,1===t.state?255:0,0)}),(function(t,e,a){var n=t.getCell(e,a);if(n.state===k.Alive){var i=e+Math.floor(3*Math.random())-1,r=a+Math.floor(3*Math.random())-1;if(t.isInBounds(i,r)){var o=t.getCell(i,r);o.state!==k.Alive&&o.nextState!==k.Alive&&(o.nextState=k.Alive,n.nextState=k.Dead)}}}));const j=new r("Move",k,I);var B={Alive:1,Dead:0},E=new h((function(t){t.draw(0,t.state===B.Alive?255:0,0)}),(function(t,e,a){var n=t.getCell(e,a),i=t.neighborsWithState(e,a,B.Alive);n.state===B.Alive?n.nextState=B.Dead:2===i&&(n.nextState=B.Alive)}));const P=new r("Seeds",B,E);function F(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function W(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}const z=function(){function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{r:0,g:0,b:0};F(this,t),this.color=a,this.state=e,this.nextState=e,this.needsDraw=!1}var e,a;return e=t,(a=[{key:"forceState",value:function(t){this.state=t,this.nextState=t,this.needsDraw=!0}},{key:"draw",value:function(t,e,a){this.color.r=t,this.color.g=e,this.color.b=a,this.needsDraw=!1}},{key:"commitStateChange",value:function(){this.needsDraw=this.needsDraw||this.state!==this.nextState,this.state=this.nextState}}])&&W(e.prototype,a),t}();function T(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}const N=function(){function t(e,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=e,this.width=e.width,this.height=e.height,this.context=e.getContext("2d"),this.imageData=this.context.createImageData(this.width,this.height),this.grid=t.generateCellSpace(this.width,this.height),this.iteration=0,this.simulation=a}var e,a,n;return e=t,n=[{key:"randomColor",value:function(){return Math.floor(255*Math.random())}},{key:"outOfBoundsError",get:function(){return new Error("Coordinates are out of bounds")}},{key:"generateCellSpace",value:function(t,e){for(var a=[],n=0;n<e;n+=1){a.push(new Array(t));for(var i=0;i<t;i+=1)a[n][i]=new z}return a}}],(a=[{key:"clear",value:function(){this.simulation.logic.clear(this)}},{key:"fill",value:function(t){this.simulation.logic.fill(this,t)}},{key:"isInBounds",value:function(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height}},{key:"isAtEdge",value:function(t,e){return 0===t||t===this.width-1||0===e||e===this.height-1}},{key:"validateIsInBounds",value:function(t,e){if(!this.isInBounds(t,e))throw new i}},{key:"getCell",value:function(t,e){return this.validateIsInBounds(t,e),this.grid[e][t]}},{key:"setCell",value:function(t,e,a){this.validateIsInBounds(t,e),this.grid[e][t]=a}},{key:"updateCell",value:function(t,e){this.validateIsInBounds(t,e),this.simulation.logic.update(this,t,e)}},{key:"drawCell",value:function(t,e){this.validateIsInBounds(t,e);var a=this.getCell(t,e);a.needsDraw&&this.simulation.logic.draw(a)}},{key:"hasNeighborWithState",value:function(t,e,a){for(var n=e-1;n<=e+1;n+=1)for(var i=t-1;i<=t+1;i+=1)if((i!==t||n!==e)&&this.isInBounds(i,n)&&this.getCell(i,n).state===a)return!0;return!1}},{key:"neighborsWithState",value:function(t,e,a){for(var n=0,i=e-1;i<=e+1;i+=1)for(var r=t-1;r<=t+1;r+=1)r===t&&i===e||!this.isInBounds(r,i)||this.getCell(r,i).state!==a||(n+=1);return n}},{key:"updateCells",value:function(){for(var t=0;t<this.height;t+=1)for(var e=0;e<this.width;e+=1)this.updateCell(e,t);for(var a=0;a<this.height;a+=1)for(var n=0;n<this.width;n+=1)this.getCell(n,a).commitStateChange()}},{key:"drawCells",value:function(){for(var t=0;t<this.height;t+=1)for(var e=0;e<this.width;e+=1)this.drawCell(e,t)}},{key:"updateImageData",value:function(){for(var t=this.imageData.data,e=0;e<t.length;e+=4){var a=e/4%this.width,n=Math.floor(e/4/this.width),i=this.getCell(a,n);t[e]=i.color.r,t[e+1]=i.color.g,t[e+2]=i.color.b,t[e+3]=255}}},{key:"drawImageData",value:function(){this.context.putImageData(this.imageData,0,0)}},{key:"step",value:function(){this.iteration+=1,this.updateCells()}},{key:"draw",value:function(){this.drawCells(),this.updateImageData(),this.drawImageData()}}])&&T(e.prototype,a),n&&T(e,n),t}();return e})()}));